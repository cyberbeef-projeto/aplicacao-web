<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Usuários</title>
  <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="css/paginasCRUD.css">
  <link rel="icon" href="assets/icon/chip.png">
</head>

<body>
  <header class="">
    <button id="but_atualizar_bl" class="clicavel bxr bxs-menu-select clicado"
      onclick="atualizarBarraLateral()"></button>
    <p>Usuários</p>
    <button class="btn primary clicado" id="btnNew">+ Novo Registro</button>
  </header>

  <div class="barra_lateral sombreado ativa">
    <div id="logo"></div>
    <hr>
    <div id="usuario">
      <i class='bxr  bxs-user' style='color:#fffafa'></i>
      <a id="b_usuario" class="texto_perfil">User</a>
    </div>
    <hr>
    <div id="home" class="ops_home">
      <ul></ul>
      <li class="clicado"><a href="">Home</a></li>
      <li class="clicado"><a href="dashboard.html">Painéis</a></li>
      <li class="clicado"><a href="">Máquinas</a></li>
      <li class="clicado"><a href="">Alertas</a></li>
      <li class="clicado"><a href="">Setores</a></li>
      <li class="clicado"><a href="">Usuários</a></li>
      <i onclick="limparSessao()" title="Clique para sair de sua conta"
        class='bxr  bx-arrow-out-left-square-half clicavel clicado' style="color: #fffafa;"></i>
    </div>
  </div>

  <div id="app" class="bl_ativa">
    <main class="list-panel">
      <table aria-label="lista de registros">
        <thead>
          <tr id="tableHead"></tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
      <div id="emptyState" class="empty">Nenhum registro.</div>
    </main>
  </div>

  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <span style="display: flex; align-items: center; flex-wrap: nowrap; gap: 1%;">
        <h3 id="modalTitle">Novo Registro</h3>
        <i class='bxr bx-help-circle info'
          data-title="Sobre Níveis de Permissão:
          1 = Visualizar somente os Painéis;
          2 = Visualizar a todos os dados;
          3 = Visualizar e editar todos os dados.
          Sobre Senhas: 
          Quando um novo usuário é criado ou a senha é editada por um administrador, por segurança, será solicitado ao usuário que teve a senha alterada uma nova senha no momento de login.
">
        </i>
      </span>
      <div class="modal-body" id="modalBody"></div>
      <div style="display:flex;gap:1%;justify-content:flex-end;margin-top:1.5%">
        <button class="btn ghost clicado" id="modalCancel">Cancelar</button>
        <button class="btn primary clicado" id="modalSave">Salvar</button>
      </div>
    </div>
  </div>

  <script>
    const campos = [
      { key: 'nome', label: 'Nome', type: 'text' },
      { key: 'email', label: 'E-mail', type: 'email' },
      { key: 'permissao', label: 'Nível de Permissão', type: 'select', options: ['1', '2', '3'] },
      { key: 'cargo', label: 'Cargo', type: 'email' },
      { key: 'senha', label: 'Senha', type: 'text', readOnly: true }
    ];

    const barraLateral = document.querySelector('.barra_lateral');
    const butAtualizarBl = document.getElementById('but_atualizar_bl');
    const elementos = document.getElementById('app');
    const tableHead = document.getElementById('tableHead');
    const tableBody = document.getElementById('tableBody');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalBody = document.getElementById('modalBody');
    const modalTitle = document.getElementById('modalTitle');



    function atualizarBarraLateral() {
      barraLateral.classList.toggle('ativa');
      elementos.classList.toggle('bl_ativa');
      butAtualizarBl.classList.toggle('bxs-menu-wide');
      butAtualizarBl.classList.toggle('bxs-menu-select');
    }

    function renderTable() {
      tableHead.innerHTML = '';
      campos.forEach(f => { const th = document.createElement('th'); th.textContent = f.label; tableHead.appendChild(th); });
      const thAct = document.createElement('th'); thAct.textContent = 'Ações'; tableHead.appendChild(thAct);
      tableBody.innerHTML = '';
      if (store.length === 0) { document.getElementById('emptyState').style.display = 'block'; return; }
      document.getElementById('emptyState').style.display = 'none';
      store.forEach((row, i) => {
        const tr = document.createElement('tr');
        campos.forEach(f => { const td = document.createElement('td'); td.textContent = row[f.key] || '-'; tr.appendChild(td); });
        const tdAct = document.createElement('td');
        const btnE = document.createElement('button'); btnE.className = 'btn clicado'; btnE.textContent = 'Editar'; btnE.onclick = () => openModal('Editar Registro', i);
        const btnD = document.createElement('button'); btnD.className = 'btn danger clicado'; btnD.textContent = 'Excluir'; btnD.onclick = () => { store.splice(i, 1); renderTable(); };
        tdAct.append(btnE, btnD); tr.appendChild(tdAct);
        tableBody.appendChild(tr);
      });
    }

    function openModal(title, index = -1) {
      editingIndex = index;
      modalTitle.textContent = title;
      modalBody.innerHTML = '';
      campos.forEach(f => {
        const wrap = document.createElement('div'); wrap.className = 'campo-card';
        const lbl = document.createElement('label'); lbl.textContent = f.label; wrap.appendChild(lbl);
        let input;
        if (f.type === 'textarea') input = document.createElement('textarea');
        else if (f.type === 'select') { input = document.createElement('select'); (f.options || []).forEach(o => { const op = document.createElement('option'); op.value = op.textContent = o; input.appendChild(op) }); }
        else input = document.createElement('input'), input.type = f.type || 'text';
        input.dataset.key = f.key;
        if (f.readOnly) input.readOnly = true;
        input.value = index >= 0 ? store[index][f.key] || '' : '';
        wrap.appendChild(input);
        modalBody.appendChild(wrap);
      });
      modalBackdrop.style.display = 'flex';
    }

    document.getElementById('btnNew').onclick = () => openModal('Novo Registro');
    document.getElementById('modalCancel').onclick = () => modalBackdrop.style.display = 'none';
    document.getElementById('modalSave').onclick = () => {
      const inputs = modalBody.querySelectorAll('[data-key]');
      const obj = {};
      inputs.forEach(i => obj[i.dataset.key] = i.value);
      if (!obj.id) obj.id = uid();
      if (editingIndex >= 0) store[editingIndex] = obj; else store.push(obj);
      modalBackdrop.style.display = 'none'; renderTable();
    };

    // seed
    store = [{ nome: 'Ana', email: 'ana@ex.com', permissao: '1', cargo: 'Analista de Segurança', senha: '***********' }, { nome: 'Marco', email: 'marco@ex.com', permissao: '3', cargo: 'Chefe de Segurança', senha: '***********' }];
    renderTable();
  </script>
</body>

</html>