<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="../empresas/empresa.css">
  <link rel="icon" href="/web-data-viz/public/assets/icon/chip.png">
  <title>Cadastro de Empresas - CyberBeef</title>
</head>

<body>
  <div class="barra_lateral sombreado ativa">

    <div id="logo">
      <img src="/web-data-viz/public/assets/imgs/logo.png" alt="">
    </div>
    <hr style="border-color: #334155;">
    <div id="usuario">
      <i class='bxs-user' style='color:#fffafa'></i>
      <a id="b_usuario">User</a>
    </div>
    <hr style="border-color: #334155;">

    <div id="home">
      <ul></ul>
      <li class="clicado"><a href="#">Home</a></li>
      <li class="clicado"><a href="#">Painéis</a></li>
      <li class="clicado"><a href="#">Máquinas</a></li>
      <li class="clicado"><a href="#">Alertas</a></li>
      <li class="clicado"><a href="#">Setores</a></li>
      <li class="clicado"><a href="#">Usuários</a></li>
      <span
        style="display: inline-flex; align-items: center; color: #fffafa; font-size: large; gap: 1%; cursor: pointer;">
        <i class='bx bx-arrow-out-left-square-half' style="color: #fffafa;"></i>
        <p>SAIR</p>
      </span>
    </div>
  </div>
  <div class="conteudo-principal">
    <header class="navbar">
      <button id="but_atualizar_bl" class="menu-btn" onclick="atualizarBarraLateral()">
        <i class='bx bx-menu'></i>
        <span id="sel_componentes" name="op_setor" class="sel_dash"></span>
      </button>

      <h1>Cadastro de Empresas</h1>
    </header>



    <div class="container-formulario">
      <div class="tabs">
        <button class="tab" onclick="mostrarAba('formulario')">Dados Empresariais</button>
        <button class="tab ativa" onclick="mostrarAba('listagem')">Empresas Cadastradas</button>
      </div>

      <!-- Formulário -->
      <form class="formulario oculto" id="formulario">
        <div class="form-row">
          <div class="form-grupo">
            <label>Razão Social</label>
            <div class="input-wrapper">
              <input type="text" placeholder="Nome" id="razaoSocial">
              <i class='bx bx-user'></i>
            </div>
          </div>
          <div class="form-grupo">
            <label>Nome Fantasia</label>
            <div class="input-wrapper">
              <input type="text" placeholder="Fantasia" id="nomeFantasia">
              <i class='bx bx-edit'></i>
            </div>
          </div>
          <div class="form-grupo">
            <label>CNPJ</label>
            <div class="input-wrapper">
              <input type="text" placeholder="CNPJ" id="cnpj">
              <i class='bx bx-edit'></i>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-gruop">
            <label>CEP</label>
            <div class="input-wrapper">
              <input type="text" placeholder="CEP" id="cep">
              <i class='bx bx-bookmark'></i>
            </div>
          </div>
          <div class="form-grupo">
            <label>Logradouro</label>
            <div class="input-wrapper">
              <input type="text" placeholder="Endereço" id="logradouro">
              <i class='bx bx-map'></i>
            </div>
          </div>
          <div class="form-grupo">
            <label>Bairro</label>
            <div class="input-wrapper">
              <input type="text" placeholder="Bairro" id="bairro">
              <i class='bx bx-map'></i>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-grupo">
            <label>Cidade</label>
            <div class="input-wrapper">
              <input type="text" placeholder="Cidade" id="cidade">
              <i class='bx bx-map'></i>
            </div>
          </div>
          <div class="form-grupo">
            <label>UF</label>
            <div class="input-wrapper">
              <select id="uf">
                <option value="">Selecione</option>
                <option value="AC">AC</option>
                <option value="AL">AL</option>
                <option value="AP">AP</option>
                <option value="AM">AM</option>
                <option value="BA">BA</option>
                <option value="CE">CE</option>
                <option value="DF">DF</option>
                <option value="ES">ES</option>
                <option value="GO">GO</option>
                <option value="MA">MA</option>
                <option value="MT">MT</option>
                <option value="MS">MS</option>
                <option value="MG">MG</option>
                <option value="PA">PA</option>
                <option value="PB">PB</option>
                <option value="PR">PR</option>
                <option value="PE">PE</option>
                <option value="PI">PI</option>
                <option value="RJ">RJ</option>
                <option value="RN">RN</option>
                <option value="RS">RS</option>
                <option value="RO">RO</option>
                <option value="RR">RR</option>
                <option value="SC">SC</option>
                <option value="SP">SP</option>
                <option value="SE">SE</option>
                <option value="TO">TO</option>
              </select>
              <i class='bx bx-chevron-down'></i>
            </div>
          </div>
          <div class="form-grupo">
            <label>Número</label>
            <div class="input-wrapper">
              <input type="text" placeholder="Número" id="numero">
              <i class='bx bx-chevron-down'></i>
            </div>
          </div>
        </div>

        <div class="form-acao">
          <button type="button" class="btn-primeiro" onclick="limparFormulario()">Cancelar</button>
          <button type="submit" class="btn-segundo">Salvar</button>
        </div>
      </form>

      <!-- Listagem -->
      <div class="container-listagem" id="listagem">
        <div class="listagem-header">
          <div class="listagem-controles">
            <label>Mostrar</label>
            <select id="registrosPorPagina" onchange="atualizarTabela()">
              <option value="10" selected>10</option>
              <option value="25">25</option>
              <option value="50">50</option>
            </select>
            <span style="color: #cbd5e1;">registros</span>
          </div>
          <div class="busca-wrapper">
            <input type="text" placeholder="Buscar..." id="campoBusca" oninput="filtrarEmpresas()">
          </div>
          <button class="btn-adicionar" onclick="mostrarAba('formulario')">
            <i class='bx bx-plus'></i>
            Adicionar
          </button>
        </div>

        <div class="tabela-wrapper">
          <table class="tabela-empresas">
            <thead>
              <tr>
                <th>Id <i class='bx bx-up-arrow-alt'></i></th>
                <th>Nome Fantasia <i class='bx bx-up-arrow-alt'></i></th>
                <th>CNPJ <i class='bx bx-up-arrow-alt'></i></th>
                <th>Data do Cadastro<i class='bx bx-up-arrow-alt'></i></th>
                <th style="text-align: center;">Ações</th>
              </tr>
            </thead>
            <tbody id="tabelaBody">

            </tbody>
          </table>
        </div>

        <div class="paginacao">
          <div class="paginacao-info">
            <span id="paginacaoInfo">1 a 2 de 2</span>
          </div>
          <div class="paginacao-controles">
            <button class="btn-pagina" id="btnAnterior" onclick="paginaAnterior()" disabled>&lt;</button>
            <button class="btn-pagina ativa" id="btnPagina1" onclick="irParaPagina(1)">1</button>
            <button class="btn-pagina" id="btnProxima" onclick="proximaPagina()" disabled>&gt;</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal formulário -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <h3 id="modalTitle">Nova Empresa</h3>
      <form id="formulario" onsubmit="salvarEmpresa(event)">
        <div class="modal-body">
          <div class="campo-card">
            <label>Razão Social *</label>
            <input type="text" id="razaoSocial" placeholder="Digite a razão social" required>
          </div>
          <div class="campo-card">
            <label>Nome Fantasia *</label>
            <input type="text" id="nomeFantasia" placeholder="Digite o nome fantasia" required>
          </div>
          <div class="campo-card">
            <label>CNPJ *</label>
            <input type="text" id="cnpj" placeholder="00.000.000/0000-00" required>
          </div>
          <div class="campo-card">
            <label>CEP</label>
            <input type="text" id="cep" placeholder="00000-000">
          </div>
          <div class="campo-card">
            <label>Logradouro</label>
            <input type="text" id="logradouro" placeholder="Digite o endereço">
          </div>
          <div class="campo-card">
            <label>Bairro</label>
            <input type="text" id="bairro" placeholder="Digite o bairro">
          </div>
          <div class="campo-card">
            <label>Cidade</label>
            <input type="text" id="cidade" placeholder="Digite a cidade">
          </div>
          <div class="campo-card">
            <label>UF</label>
            <select id="uf">
              <option value="">Selecione</option>
              <option value="AC">AC</option>
              <option value="AL">AL</option>
              <option value="AP">AP</option>
              <option value="AM">AM</option>
              <option value="BA">BA</option>
              <option value="CE">CE</option>
              <option value="DF">DF</option>
              <option value="ES">ES</option>
              <option value="GO">GO</option>
              <option value="MA">MA</option>
              <option value="MT">MT</option>
              <option value="MS">MS</option>
              <option value="MG">MG</option>
              <option value="PA">PA</option>
              <option value="PB">PB</option>
              <option value="PR">PR</option>
              <option value="PE">PE</option>
              <option value="PI">PI</option>
              <option value="RJ">RJ</option>
              <option value="RN">RN</option>
              <option value="RS">RS</option>
              <option value="RO">RO</option>
              <option value="RR">RR</option>
              <option value="SC">SC</option>
              <option value="SP">SP</option>
              <option value="SE">SE</option>
              <option value="TO">TO</option>
            </select>
          </div>
          <div class="campo-card">
            <label>Número</label>
            <input type="text" id="numero" placeholder="Nº">
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-segundo clicado" onclick="fecharModal()">Cancelar</button>
          <button type="submit" class="btn-primeiro clicado">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal confirmação de  Exclusão -->
  <div class="modal-backdrop" id="modalExcluir">
    <div class="modal" style="max-width: 500px;">
      <h3 style="color: #f87171; display: flex; align-items: center; gap: 0.5rem;">
        <i class='bx bx-error-circle' style="font-size: 1.8rem;"></i>
        Confirmar Exclusão
      </h3>
      <div style="margin: 1.5rem 0;">
        <p style="color: #cbd5e1; font-size: 1rem; line-height: 1.6;">
          Tem certeza que deseja excluir a empresa <strong id="nomeEmpresaExcluir" style="color: #fff;"></strong>?
        </p>
        <p style="color: #9ca3af; font-size: 0.875rem; margin-top: 0.75rem;">
          Esta ação não poderá ser desfeita.
        </p>
      </div>
      <div class="modal-actions" style="margin-top: 1.5rem;">
        <button type="button" class="btn-segundo clicado" onclick="fecharModalExcluir()">Cancelar</button>
        <button type="button" class="btn-primeiro clicado" style="background-color: #dc2626;"
          onclick="confirmarExclusao()">Excluir</button>
      </div>
    </div>
  </div>

  <script>

    /* Aruumar de acordo com o BD*/ /*Script de simulação*/
    let empresas = [
      { nome: "Testes", nomeFantasia: "Testes", cnpj: "15743265000157", cep: "", logradouro: "", bairro: "", cidade: "", uf: "", numero: "" },
      { nome: "Testes2", nomeFantasia: "Testes2", cnpj: "30884974000146", cep: "", logradouro: "", bairro: "", cidade: "", uf: "", numero: "" }
    ];

    let paginaAtual = 1;
    let registrosPorPagina = 10;
    let empresasFiltradas = [...empresas];
    let editandoIndex = -1;
    let excluindoIndex = -1;

    function atualizarTabela() {
      registrosPorPagina = parseInt(document.getElementById('registrosPorPagina').value);
      paginaAtual = 1;
      renderizarTabela();
    }


    function mostrarAba(aba) {
      const formulario = document.getElementById('formulario');
      const listagem = document.getElementById('listagem');
      const tabs = document.querySelectorAll('.tab');

      if (aba === 'formulario') {
        formulario.classList.remove('oculto');
        listagem.classList.add('oculto');
        tabs[0].classList.add('ativa');
        tabs[1].classList.remove('ativa');
      } else {
        formulario.classList.add('oculto');
        listagem.classList.remove('oculto');
        tabs[0].classList.remove('ativa');
        tabs[1].classList.add('ativa');
      }
    }
    function filtrarEmpresas() {
      const busca = document.getElementById('campoBusca').value.toLowerCase();
      empresasFiltradas = empresas.filter(emp =>
        emp.nome.toLowerCase().includes(busca) ||
        emp.nomeFantasia.toLowerCase().includes(busca) ||
        emp.cnpj.includes(busca)
      );
      paginaAtual = 1;
      renderizarTabela();
    }

    function renderizarTabela() {
      const tbody = document.getElementById('tabelaBody');
      const inicio = (paginaAtual - 1) * registrosPorPagina;
      const fim = inicio + registrosPorPagina;
      const empresasPagina = empresasFiltradas.slice(inicio, fim);

      tbody.innerHTML = empresasPagina.map((emp, index) => `
        <tr>
          <td>${emp.nome}</td>
          <td>${emp.nomeFantasia}</td>
          <td>${emp.cnpj}</td>
          <td>
            <div class="acoes-td">
              <button class="btn-acao btn-editar clicado" onclick="editarEmpresa(${inicio + index})" title="Editar">
                <i class='bx bx-edit'></i>
              </button>
              <button class="btn-acao btn-excluir clicado" onclick="excluirEmpresa(${inicio + index})" title="Excluir">
                <i class='bx bx-trash'></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');

      atualizarPaginacao();
    }

    function atualizarPaginacao() {
      const total = empresasFiltradas.length;
      const inicio = (paginaAtual - 1) * registrosPorPagina + 1;
      const fim = Math.min(inicio + registrosPorPagina - 1, total);

      document.getElementById('paginacaoInfo').textContent = `${inicio} a ${fim} de ${total}`;

      const totalPaginas = Math.ceil(total / registrosPorPagina);
      document.getElementById('btnAnterior').disabled = paginaAtual === 1;
      document.getElementById('btnProxima').disabled = paginaAtual === totalPaginas || total === 0;
    }

    function proximaPagina() {
      const totalPaginas = Math.ceil(empresasFiltradas.length / registrosPorPagina);
      if (paginaAtual < totalPaginas) {
        paginaAtual++;
        renderizarTabela();
      }
    }

    function paginaAnterior() {
      if (paginaAtual > 1) {
        paginaAtual--;
        renderizarTabela();
      }
    }

    function irParaPagina(pagina) {
      paginaAtual = pagina;
      renderizarTabela();
    }

    function abrirModal() {
      editandoIndex = -1;
      document.getElementById('modalTitle').textContent = 'Nova Empresa';
      document.getElementById('formulario').reset();
      document.getElementById('modalBackdrop').style.display = 'flex';
    }

    function editarEmpresa(index) {
      const empresaReal = empresas.indexOf(empresasFiltradas[index]);
      editandoIndex = empresaReal;
      const empresa = empresas[empresaReal];

      document.getElementById('modalTitle').textContent = 'Editar Empresa';
      document.getElementById('razaoSocial').value = empresa.nome || '';
      document.getElementById('nomeFantasia').value = empresa.nomeFantasia || '';
      document.getElementById('cnpj').value = empresa.cnpj || '';
      document.getElementById('cep').value = empresa.cep || '';
      document.getElementById('logradouro').value = empresa.logradouro || '';
      document.getElementById('bairro').value = empresa.bairro || '';
      document.getElementById('cidade').value = empresa.cidade || '';
      document.getElementById('uf').value = empresa.uf || '';
      document.getElementById('numero').value = empresa.numero || '';

      document.getElementById('modalBackdrop').style.display = 'flex';
    }

    function fecharModal() {
      document.getElementById('modalBackdrop').style.display = 'none';
      document.getElementById('formulario').reset();
      editandoIndex = -1;
    }

    function salvarEmpresa(event) {
      event.preventDefault();

      const empresa = {
        nome: document.getElementById('razaoSocial').value,
        nomeFantasia: document.getElementById('nomeFantasia').value,
        cnpj: document.getElementById('cnpj').value,
        cep: document.getElementById('cep').value,
        logradouro: document.getElementById('logradouro').value,
        bairro: document.getElementById('bairro').value,
        cidade: document.getElementById('cidade').value,
        uf: document.getElementById('uf').value,
        numero: document.getElementById('numero').value
      };

      if (editandoIndex >= 0) {
        empresas[editandoIndex] = empresa;
      } else {
        empresas.push(empresa);
      }

      fecharModal();
      filtrarEmpresas();
    }

    function excluirEmpresa(index) {
      const empresaReal = empresas.indexOf(empresasFiltradas[index]);
      excluindoIndex = empresaReal;
      const empresa = empresas[empresaReal];

      document.getElementById('nomeEmpresaExcluir').textContent = empresa.nome;
      document.getElementById('modalExcluir').style.display = 'flex';
    }

    function fecharModalExcluir() {
      document.getElementById('modalExcluir').style.display = 'none';
      excluindoIndex = -1;
    }

    function confirmarExclusao() {
      if (excluindoIndex >= 0) {
        empresas.splice(excluindoIndex, 1);
        fecharModalExcluir();
        filtrarEmpresas();
      }
    }


    renderizarTabela();
  </script>
</body>

</html>