<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="css/disponibilidade.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="assets/icon/chip.png">

    <title>Monitoramento de Disponibilidade - CyberBeef</title>

    <style>
        /* Estilos Adicionais para a Dashboard */
        .status-badge {
            padding: 0.3vw 0.8vw;
            border-radius: 2vh;
            font-size: 0.75vw;
            font-weight: bold;
            text-transform: uppercase;
            display: inline-block;
        }

        .status-up {
            background-color: rgba(0, 255, 127, 0.15);
            color: #00ff7f;
            border: 1px solid rgba(0, 255, 127, 0.3);
        }

        .status-down {
            background-color: rgba(255, 0, 80, 0.15);
            color: #ff0050;
            border: 1px solid rgba(255, 0, 80, 0.3);
        }

        .status-warn {
            background-color: rgba(255, 165, 0, 0.15);
            color: #ffa500;
            border: 1px solid rgba(255, 165, 0, 0.3);
        }

        .log-table {
            width: 100%;
            border-collapse: collapse;
            color: #cfd7ff;
            font-size: 0.9vw;
        }

        .log-table th {
            text-align: left;
            padding: 1vh;
            border-bottom: 2px solid rgba(75, 108, 240, 0.3);
            color: #fff;
            position: sticky;
            top: 0;
            background-color: rgb(11, 15, 25);
        }

        .log-table td {
            padding: 1.2vh 1vh;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>
</head>

<body>
    <header class="navbar">
        <button id="but_atualizar_bl" class="clicavel bxr bxs-menu-select clicado"
            onclick="atualizarBarraLateral()"></button>

        <span id="sel_componentes" name="op_setor" class="sel_dash">
            <p id="title">Monitoramento de Disponibilidade</p>
        </span>

        <nav id="buts_superiores">
            <a href="#" class="clicavel clicado">Exportar Log <i class='bx bxs-file-pdf'
                    style="padding: 0.3rem;"></i></a>
        </nav>
    </header>

    <div class="barra_lateral sombreado ativa">
        <div id="logo"></div>
        <hr>

        <div id="usuario">
            <i class='bxr bxs-user' style='color:#fffafa'></i>
            <a id="b_usuario" class="texto_perfil" style="max-width: 100%; overflow: hidden; text-overflow: ellipsis;">
                Administrador
            </a>
        </div>

        <hr>

        <div id="home" class="ops_home">
            <ul></ul>
            <li class="clicado"><a href="acesso.html">Controle e Acesso</a></li>
            <li class="clicado"><a href="empresa.html">Empresas</a></li>

            <!-- <li class="clicado" style="background-color: rgba(255,255,255,0.1); border-left: 0.3vw solid #4B6CF0;"> -->
            <li class="clicado">
                <a href="dados.html?tipoDados=alerta&titulo=Alertas">Disponibilidade</a>
            </li>

            <li class="clicado"><a href="jira-empresa.html">Chamados Jira</a></li>

            <span onclick="limparSessao()"
                style="display: inline-flex; align-items: center; color: #fffafa; font-size: large; gap: 1%; margin-top: 20px;"
                class="clicavel clicado" title="Clique para encerrar sua sessão">
                <i class='bxr bx-arrow-out-left-square-half' style="color: #fffafa;"></i>
                <p>Sair <a href="index.html"></a></p>
            </span>
        </div>
    </div>

    <div id="elementos" class="bl_ativa">
        <div class="cards">
            <div id="barra_pesquisa">
                <select id="periodo-select" class="interativo"
                    style="background: rgb(11, 15, 25); color: white; border: 1px solid #4B6CF0; padding: 5px; border-radius: 5px; width: auto;">
                    <option>Hoje</option>
                    <option>Últimos 7 Dias</option>
                    <option>Este Mês</option>
                </select>
            </div>

            <span class="abas_kpis">
                <button data-aba="1" class="kpi interativo">
                    <span class="info-icon"><i class='bx bx-info-circle'></i><span class="tooltip">Total de
                            servidores/máquinas sendo monitorados.</span></span>
                    <b id="kpi_maquinas" class="dado_card">128</b>
                    <p class="text_longo">Máquinas Monitoradas</p>
                    <i class="text_longo">Total Ativo</i>
                </button>

                <button data-aba="2" class="kpi interativo ativa">
                    <span class="info-icon"><i class='bx bx-info-circle'></i><span class="tooltip">Tempo corrido desde a
                            última interrupção geral.</span></span>
                    <b id="kpi_tempo_up" class="dado_card" style="color: #00ff7f;">42h 15m</b>
                    <p class="text_longo">Tempo sem Downtime</p>
                    <i class="text_longo">Estabilidade Global</i>
                </button>

                <button data-aba="3" class="kpi interativo">
                    <span class="info-icon"><i class='bx bx-info-circle'></i><span class="tooltip">Volume de dados de
                            monitoramento recebidos por minuto.</span></span>
                    <b id="kpi_capturas" class="dado_card">2.450</b>
                    <p class="text_longo">Capturas por Minuto</p>
                    <i class="text_longo">Throughput</i>
                </button>

                <button data-aba="4" class="kpi interativo">
                    <span class="info-icon"><i class='bx bx-info-circle'></i><span class="tooltip">Data e hora do último
                            incidente crítico registrado.</span></span>
                    <b id="kpi_last_down" class="dado_card" style="color: #ff0050;">24/11</b>
                    <p class="text_longo">Data Último Downtime</p>
                    <i class="text_longo">Às 14:30 (SRV-04)</i>
                </button>
            </span>

            <div class="graficos-meio">
                <span class="grafico-duplo sombreado interativo">
                    <canvas id="chartDowntimesMaquina"></canvas>
                </span>
                <span class="grafico-duplo sombreado interativo">
                    <canvas id="chartProporcao"></canvas>
                </span>
            </div>

            <div id="cardsContainer"></div>
        </div>

        <div id="graficos">
            <span class="grafico sombreado interativo" style="height: auto; min-height: 300px;">
                <div class="map-title"
                    style="display: flex; justify-content: space-between; align-items: center; padding: 0 5px; width: 100%;">
                    <span>Monitoramento de Recursos</span>
                </div>

                <div class="status-container">
                    <div class="component-item">
                        <div class="comp-info">
                            <span class="comp-name">Uso Global de CPU</span>
                            <span class="comp-sub">Média do Cluster: 12%</span>
                        </div>
                        <div class="comp-status">
                            <span class="status-text color-up">ESTÁVEL</span>
                            <div class="led led-green"></div>
                        </div>
                    </div>

                    <div class="component-item">
                        <div class="comp-info">
                            <span class="comp-name">Memória RAM</span>
                            <span class="comp-sub">Disponível: 64GB / 128GB</span>
                        </div>
                        <div class="comp-status">
                            <span class="status-text color-up">NORMAL</span>
                            <div class="led led-green"></div>
                        </div>
                    </div>

                    <div class="component-item">
                        <div class="comp-info">
                            <span class="comp-name">Armazenamento (Disco)</span>
                            <span class="comp-sub">SRV-04 Critico: 98% Cheio</span>
                        </div>
                        <div class="comp-status">
                            <span class="status-text color-down">CHEIO</span>
                            <div class="led led-red"></div>
                        </div>
                    </div>

                    <div class="component-item">
                        <div class="comp-info">
                            <span class="comp-name">Interface de Rede (Eth0)</span>
                            <span class="comp-sub">Pacotes Perdidos: 15%</span>
                        </div>
                        <div class="comp-status">
                            <span class="status-text color-warn">INSTÁVEL</span>
                            <div class="led led-yellow"></div>
                        </div>
                    </div>

                    <div class="component-item">
                        <div class="comp-info">
                            <span class="comp-name">Agentes Ativos</span>
                            <span class="comp-sub">127 de 128 respondendo</span>
                        </div>
                        <div class="comp-status">
                            <span class="status-text color-up">ONLINE</span>
                            <div class="led led-green"></div>
                        </div>
                    </div>
                </div>
            </span>
        </div>
    </div>

    <script>
        // --- Lógica dos Gráficos (Chart.js) ---
        const ctx1 = document.getElementById('chartDowntimesMaquina').getContext('2d');
        const gradientBar = ctx1.createLinearGradient(0, 0, 0, 300);
        gradientBar.addColorStop(0, '#4B6CF0');
        gradientBar.addColorStop(1, 'rgba(75, 108, 240, 0.2)');

        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['SRV-Banco-01', 'SRV-Web-02', 'AWS-Lambda', 'SRV-Legacy', 'SRV-App-04'],
                datasets: [{
                    label: 'Qtd. Downtimes',
                    data: [5, 3, 2, 2, 1],
                    backgroundColor: gradientBar,
                    borderRadius: 6,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: { display: true, text: 'Top Máquinas com Downtime', color: '#fff', font: { size: 16 } },
                    legend: { display: false }
                },
                scales: {
                    x: { ticks: { color: '#cfd7ff', font: { size: 10 } }, grid: { display: false } },
                    y: { ticks: { color: '#cfd7ff', stepSize: 1 }, grid: { color: 'rgba(255,255,255,0.05)' } }
                }
            }
        });

        const ctx2 = document.getElementById('chartProporcao').getContext('2d');
        new Chart(ctx2, {
            type: 'doughnut',
            data: {
                labels: ['Uptime (Disponível)', 'Downtime (Indisponível)'],
                datasets: [{
                    data: [96.5, 3.5],
                    backgroundColor: ['#00ff7f', '#ff0050'],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    title: { display: true, text: 'Disponibilidade Global (%)', color: '#fff', font: { size: 16 } },
                    legend: { position: 'bottom', labels: { color: '#fff', padding: 20, usePointStyle: true } }
                }
            }
        });

        // --- Lógica da Barra Lateral ---
        function atualizarBarraLateral() {
            const barraLateral = document.querySelector('.barra_lateral');
            const elementos = document.getElementById('elementos');

            if (barraLateral.classList.contains('ativa')) {
                barraLateral.classList.remove('ativa');
                elementos.classList.remove('bl_ativa');
            } else {
                barraLateral.classList.add('ativa');
                elementos.classList.add('bl_ativa');
            }
        }

        function limparSessao() {
            alert('Sessão encerrada com sucesso!');
            window.location.href = "index.html";
        }
    </script>
</body>

</html>